"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var i in n=arguments[t])Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i]);return e}).apply(this,arguments)},__spreadArray=this&&this.__spreadArray||function(e,n,t){if(t||2===arguments.length)for(var r,i=0,a=n.length;i<a;i++)!r&&i in n||(r||(r=Array.prototype.slice.call(n,0,i)),r[i]=n[i]);return e.concat(r||Array.prototype.slice.call(n))},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.IndustrialProvider=exports.composeDomId=void 0;var jsx_runtime_1=require("react/jsx-runtime"),react_1=require("react"),index_types_1=require("../index.types"),Wrapper_1=__importDefault(require("../internal/Wrapper")),logger_1=require("../utils/logger"),domIdBase="mui-status",composeDomId=function(e,n){var t=n.join("-");return"".concat(domIdBase,"-").concat(e,"-").concat(t)};exports.composeDomId=composeDomId;var packageName="mui-industrial",keyboardOverridesStorageKey="".concat(packageName,".keyboard.overrides"),initialSettings={position:index_types_1.PlacementPosition.TOP,expand:!0,statusBarAnnounced:!1,allowRightClick:!0,debug:!1,capsLock:!1,hasLock:!0,hasBorder:!0,variant:"default",isConsoleFixed:!1,isConsoleOpen:!1},valOrDefault=function(e,n){return void 0===e?n:e},DataContext=(0,react_1.createContext)({}),IndustrialProvider=function(e){var n=e.expand,t=e.hasLock,r=e.position,i=void 0===r?index_types_1.PlacementPosition.TOP:r,a=e.allowRightClick,o=e.hasBorder,s=void 0===o||o,u=e.fullWidth,d=void 0!==u&&u,c=e.justifyContent,l=void 0===c?"space-between":c,f=e.debug,g=e.children,_=e.style,p=e.size,y=void 0===p?"small":p,v=e.variant,h=void 0===v?"default":v,m=(0,react_1.useState)([]),b=m[0],I=m[1],S=(0,react_1.useState)([]),k=S[0],C=S[1],x=(0,react_1.useState)([]),O=x[0],A=x[1],D=(0,react_1.useState)([]),K=D[0],w=D[1],T=(0,react_1.useState)(initialSettings),R=T[0],q=T[1],P=function(e){R.debug&&console.log(e)},j=(0,react_1.useCallback)(function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];R.debug&&logger_1.logPackage.apply(void 0,e)},[R.debug]),B=(0,react_1.useCallback)(function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];R.debug&&logger_1.lognPackage.apply(void 0,e)},[R.debug]);function E(e,n,t,r){return"".concat(e,"-").concat(n,"-").concat(t||"empty","-").concat(r||"empty")}function N(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return e.join("-")}var U=function(e){var n=e.id,t=e.label,r=e.ascii,i=e.char,a=e.altKey,o=e.ctrlKey,s=e.metaKey,u=e.shiftKey,d=e.onTrigger,c=e.insensitive,l=K.find(function(e){return e.id===n});if(!l||E(l.id,l.label,l.ascii,l.char)!==E(n,t,r,i)){var f,g={id:n,label:t,char:i,ascii:r,onTrigger:d,altKey:a,ctrlKey:o,metaKey:s,shiftKey:u,insensitive:c},_=localStorage.getItem(keyboardOverridesStorageKey);if(_)try{(f=JSON.parse(_).filter(function(e){return e.id===n}).filter(function(e){return JSON.stringify(e.original)===JSON.stringify(g)}).find(function(e){return e}))&&(g=__assign(__assign({},f),{onTrigger:d,original:g}))}catch(e){j("‚ùå Failed to parse keyboard overrides",e)}w(function(e){var t=__spreadArray(__spreadArray([],e.filter(function(e){return e.id!==n}),!0),[g],!1);return j("‚ûï Registered keyboard",n,t),t})}},L=function(e){var n=e.id,t=e.shortcutId,r=e.label,i=e.onTrigger,a=e.disabled,o=e.hidden,s=e.icon,u=e.order,d=e.tooltip,c=O.find(function(e){return e.id===n});if(!c||N(c.id,c.shortcutId,c.label,c.tooltip)!==N(n,t,r,d)){var l={id:n,label:r,shortcutId:t,onTrigger:i,disabled:a,hidden:o,icon:s,order:u,tooltip:d};A(function(e){var t=__spreadArray(__spreadArray([],e.filter(function(e){return e.id!==n}),!0),[l],!1);return j("‚ûï Registered command",n,t),t})}};(0,react_1.useEffect)(function(){},[]),(0,react_1.useEffect)(function(){q(function(e){return __assign(__assign({},e),{expand:n||initialSettings.expand,position:i,justifyContent:l,hasBorder:s,size:y,variant:h,fullWidth:d,allowRightClick:a||initialSettings.allowRightClick,debug:f||initialSettings.debug,hasLock:valOrDefault(t,initialSettings.hasLock)})})},[a,d,h,s,y,l,n,i,f,t]);var J=(0,react_1.useCallback)(function(e,n){R.debug&&(B(e,n.length),j(n.length>0?__spreadArray([],n,!0):"No entries found."))},[R.debug,j,B]);return(0,react_1.useEffect)(function(){return J("üóÑÔ∏è Status",b)},[b,J]),(0,react_1.useEffect)(function(){return J("üìü Snackbar",k)},[k,J]),(0,react_1.useEffect)(function(){return J("ü´ô Shortcuts",K)},[K,J]),(0,react_1.useEffect)(function(){return J("üéØ Commands",O)},[O,J]),(0,jsx_runtime_1.jsx)(DataContext.Provider,__assign({value:{settings:R,updateConsoleActiveId:function(e){var n=e.id;q(function(e){return __assign(__assign({},e),{consoleActiveId:n||void 0,isConsoleOpen:!!n})})},updateIsConsoleOpen:function(){q(function(e){return __assign(__assign({},e),{isConsoleOpen:!e.isConsoleOpen})})},updateIsConsoleClosed:function(){q(function(e){return __assign(__assign({},e),{isConsoleOpen:!1})})},triggerStatusBarAnnounced:function(){R.statusBarAnnounced||q(function(e){return __assign(__assign({},e),{statusBarAnnounced:!0})})},commands:O,handleCommandRegister:L,handleCommandsRegister:function(e){e.forEach(function(e){L(e)})},handleCallCommand:function(e){var n=O.find(function(n){return n.id===e});n&&(null==n?void 0:n.onTrigger)&&(j("üí° Triggered command",n.id),null==n||n.onTrigger())},handleCommandsDeRegister:function(e){A(function(n){var t=__spreadArray([],n.filter(function(n){return!e.some(function(e){return e===n.id})}),!0);return j("‚ûñ Destroyed commands",e,t),t})},shortcuts:K,handleKeyboardRegister:U,handleKeyboardsRegister:function(e){e.forEach(function(e){U(e)})},handleKeyboardDeRegister:function(e){w(function(n){var t=__spreadArray([],n.filter(function(n){return n.id!==e}),!0);return j("‚ûñ Destroyed keyboard",e,t),t})},handleKeyboardsDeRegister:function(e){w(function(n){var t=__spreadArray([],n.filter(function(n){return!e.some(function(e){return e===n.id})}),!0);return j("‚ûñ Destroyed keyboards",e,t),t})},handleKeyboardUpdate:function(e,n){w(function(t){var r=__spreadArray([],t.map(function(t){return t.id===e?__assign(__assign({},n),{original:t.original||t}):t}),!0);return localStorage.setItem(keyboardOverridesStorageKey,JSON.stringify(r)),j("‚öôÔ∏è Updated keyboard",e,r),r})},handleKeyboardRevert:function(e){w(function(n){var t=__spreadArray([],n.map(function(n){return n.id===e&&n.original?__assign({},n.original):n}),!0);return localStorage.setItem(keyboardOverridesStorageKey,JSON.stringify(t)),j("‚öôÔ∏è Reverted keyboard to original settings",e,t),t})},handleKeyboardTrigger:function(e){var n=K.find(function(n){return n.id===e});n&&(null==n?void 0:n.onTrigger)&&(j("üí° Triggered keyboard",n.id),null==n||n.onTrigger())},handleKeyboardGetLabel:function(e){var n;return null===(n=K.find(function(n){return n.id===e}))||void 0===n?void 0:n.label},snackbar:k,handleSnackbarRegister:function(e){var n=e.severity,t=e.actions,r=e.source,i=e.message,a=e.code,o=e.autoHideDuration,s=Math.random().toString(36).substring(7);console.log("registed snackbar",s),C(function(e){return __spreadArray(__spreadArray([],e.filter(function(e){return e.id!==s}),!0),[{id:s,open:!0,severity:n,actions:t,source:r,message:i,code:a,autoHideDuration:o||5e3}],!1)})},handleSnackbarCleaning:function(){C(function(){return[]})},status:b,handleStatusVisibilityToggle:function(e){var n=e.id;I(function(e){return e.map(function(e){return e.uniqueId===n?__assign(__assign({},e),{visible:!e.visible}):e})})},handleStatusKeepOpenToggle:function(e){var n=e.id;I(function(e){return e.map(function(e){return e.uniqueId===n?__assign(__assign({},e),{keepOpen:!e.keepOpen}):e})})},handleStatusTypeUpdate:function(e){var n=e.id,t=e.type;R.debug&&console.info("mui-status: üÜó Updated type for id: [".concat(n,"] to: [").concat(t,"]")),I(function(e){return e.map(function(e){return e.uniqueId===n?__assign(__assign({},e),{type:t}):e})})},handleStatusConsoleTitleUpdate:function(e){var n=e.id,t=e.title;R.debug&&console.info("mui-status: üÜó Updated console title for id: [".concat(n,"] to: [").concat(t,"]")),I(function(e){return e.map(function(e){return e.uniqueId===n?__assign(__assign({},e),{title:t}):e})})},handleStatusUpdate:function(e){var n=e.id,t=e.ownId,r=e.children;I(function(e){var i=e.find(function(e){return e.uniqueId===n});return(null==i?void 0:i.ownId)!==t?(R.debug&&console.error("mui-status: ‚ùå Faulty status update captured for: [".concat(n,"] & ownId: [").concat(t,"], but expected ownId: [").concat(null==i?void 0:i.ownId,"]")),e):e.map(function(e){return e.uniqueId===n&&e.ownId===t?__assign(__assign({},e),{children:r}):e})})},handleStatusAnnouncement:function(e){var n=e.id,t=e.ownId,r=e.secondary,i=e.children,a=e.options;I(function(e){var o=e.find(function(e){return e.uniqueId===n&&e.ownId!==t});return o?(P("mui-status: ‚ùå Status entry already registered with id: [".concat(n,"] & ownId: [").concat(t,"], but was proposed ownId [").concat(o.ownId,"]")),e):(j("‚ûï Registered status",n,t,r,i,a),__spreadArray(__spreadArray([],e.filter(function(e){return e.uniqueId!==n}),!0),[{index:e.length,uniqueId:n,ownId:t,options:a,keepOpen:!1,visible:!0,secondary:r,children:i}],!1))})},handleStatusDestroy:function(e){var n=e.id;I(function(e){return __spreadArray([],e.filter(function(e){return e.uniqueId!==n}),!0)})},logDebug:P}},{children:(0,jsx_runtime_1.jsx)(Wrapper_1.default,__assign({},{children:g,style:_}))}))};exports.IndustrialProvider=IndustrialProvider,exports.default=DataContext;