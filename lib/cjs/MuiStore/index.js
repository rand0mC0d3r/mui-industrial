"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var n,e=1,i=arguments.length;e<i;e++)for(var s in n=arguments[e])Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s]);return t}).apply(this,arguments)},__spreadArray=this&&this.__spreadArray||function(t,n,e){if(e||2===arguments.length)for(var i,s=0,o=n.length;s<o;s++)!i&&s in n||(i||(i=Array.prototype.slice.call(n,0,s)),i[s]=n[s]);return t.concat(i||Array.prototype.slice.call(n))},__importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.MuiStatusProvider=exports.composeDomId=void 0;var jsx_runtime_1=require("react/jsx-runtime"),react_1=require("react"),index_types_1=require("../index.types"),MuiWrapper_1=__importDefault(require("../MuiWrapper")),domIdBase="mui-status",composeDomId=function(t,n){var e=n.join("-");return"".concat(domIdBase,"-").concat(t,"-").concat(e)};exports.composeDomId=composeDomId;var settingsStorageKey="mui-status.settings",statusStorageKey="mui-status.status",initialSettings={position:index_types_1.PlacementPosition.Top,expand:!0,statusBarAnnounced:!1,allowRightClick:!0,debug:!1,hasLock:!0,isConsoleFixed:!1,isConsoleOpen:!1},valOrDefault=function(t,n){return void 0===t?n:t},DataContext=(0,react_1.createContext)({});function MuiStatusProvider(t){var n=t.expand,e=t.hasLock,i=t.position,s=void 0===i?index_types_1.PlacementPosition.Top:i,o=t.allowRightClick,a=t.debug,r=t.children,u=(0,react_1.useState)([]),c=u[0],d=u[1],l=(0,react_1.useState)(initialSettings),_=l[0],f=l[1],p=function(t){_.debug&&console.log(t)};return(0,react_1.useEffect)(function(){},[]),(0,react_1.useEffect)(function(){return localStorage.setItem(settingsStorageKey,JSON.stringify(_))},[_]),(0,react_1.useEffect)(function(){return localStorage.setItem(statusStorageKey,JSON.stringify(c.map(function(t){return __assign(__assign({},t),{children:void 0})})))},[c]),(0,react_1.useEffect)(function(){f(function(t){return __assign(__assign({},t),{expand:n||initialSettings.expand,position:s,allowRightClick:o||initialSettings.allowRightClick,debug:a||initialSettings.debug,hasLock:valOrDefault(e,initialSettings.hasLock)})})},[o,n,s,a,e]),(0,react_1.useEffect)(function(){_.debug&&console.log("mui-status-store:",__assign(__assign({},_),{status:c}))},[_,c]),(0,jsx_runtime_1.jsx)(DataContext.Provider,__assign({value:{settings:_,updateConsoleActiveId:function(t){var n=t.id;f(function(t){return __assign(__assign({},t),{consoleActiveId:n||void 0,isConsoleOpen:!!n})})},updateIsConsoleOpen:function(){f(function(t){return __assign(__assign({},t),{isConsoleOpen:!t.isConsoleOpen})})},updateIsConsoleClosed:function(){f(function(t){return __assign(__assign({},t),{isConsoleOpen:!1})})},triggerStatusBarAnnounced:function(){_.statusBarAnnounced||f(function(t){return __assign(__assign({},t),{statusBarAnnounced:!0})})},status:c,handleStatusVisibilityToggle:function(t){var n=t.id;d(function(t){return t.map(function(t){return t.uniqueId===n?__assign(__assign({},t),{visible:!t.visible}):t})})},handleStatusTypeUpdate:function(t){var n=t.id,e=t.type;_.debug&&console.info("mui-status: 🆗 Updated type for id: [".concat(n,"] to: [").concat(e,"]")),d(function(t){return t.map(function(t){return t.uniqueId===n?__assign(__assign({},t),{type:e}):t})})},handleStatusConsoleTypeUpdate:function(t){var n=t.id,e=t.title;_.debug&&console.info("mui-status: 🆗 Updated console title for id: [".concat(n,"] to: [").concat(e,"]")),d(function(t){return t.map(function(t){return t.uniqueId===n?__assign(__assign({},t),{title:e}):t})})},handleStatusUpdate:function(t){var n=t.id,e=t.ownId,i=t.children;d(function(t){var s=t.find(function(t){return t.uniqueId===n});return(null==s?void 0:s.ownId)!==e?(_.debug&&console.error("mui-status: ❌ Faulty status update captured for: [".concat(n,"] & ownId: [").concat(e,"], but expected ownId: [").concat(null==s?void 0:s.ownId,"]")),t):t.map(function(t){return t.uniqueId===n&&t.ownId===e?__assign(__assign({},t),{children:i}):t})})},handleStatusAnnouncement:function(t){var n=t.id,e=t.ownId,i=t.secondary,s=t.children;d(function(t){var o=t.find(function(t){return t.uniqueId===n&&t.ownId!==e});return o?(p("mui-status: ❌ Status entry already registered with id: [".concat(n,"] & ownId: [").concat(e,"], but was proposed ownId [").concat(o.ownId,"]")),t):(p("mui-status: 🆗 Status entry registered with id: [".concat(n,"] & ownId: [").concat(e,"]")),__spreadArray(__spreadArray([],t.filter(function(t){return t.uniqueId!==n}),!0),[{index:t.length,uniqueId:n,ownId:e,visible:!0,secondary:i,children:s}],!1))})},handleStatusDestroy:function(t){var n=t.id;d(function(t){return __spreadArray([],t.filter(function(t){return t.uniqueId!==n}),!0)})},logDebug:p}},{children:(0,jsx_runtime_1.jsx)(MuiWrapper_1.default,__assign({},{children:r}))}))}exports.MuiStatusProvider=MuiStatusProvider,exports.default=DataContext;