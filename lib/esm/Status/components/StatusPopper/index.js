var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var n,o=1,t=arguments.length;o<t;o++)for(var s in n=arguments[o])Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s]);return e}).apply(this,arguments)};import{jsx as _jsx,Fragment as _Fragment,jsxs as _jsxs}from"react/jsx-runtime";import{useContext,useEffect,useRef,useState}from"react";import{Highlight}from"../../../index.types";import DataProvider from"../../../Store";import StatusCore from"../StatusCore";import Component from"./Component";var defaultPopperOptions={elevation:2,hasToolbar:!0,onClose:function(){},open:!1,hasArrow:!1,hasDecoration:!1},defaultSeparatorOptions={start:!1,end:!1};export default function(e){var n=e.id,o=e.order,t=e.disabled,s=e.highlight,r=void 0===s?Highlight.DEFAULT:s,i=e.options,a=e.secondary,l=void 0!==a&&a,u=e.tooltip,p=void 0===u?"":u,c=e.onClick,d=e.onContextMenu,f=e.style,_=e.className,g=e.children,h=useState(null),m=h[0],v=h[1],x=useState(null),C=x[0],O=x[1],j=useState(!1),S=j[0],y=j[1],E=useContext(DataProvider).status,P=useRef(),b=__assign(__assign({},defaultPopperOptions),null==i?void 0:i.popper),k=__assign(__assign({},defaultSeparatorOptions),null==i?void 0:i.separators);useEffect(function(){var e=E.find(function(e){return e.uniqueId===n});e&&v(e)},[E,n]),useEffect(function(){C||y(!1)},[C]),useEffect(function(){(null==i?void 0:i.open)&&y(null==i?void 0:i.open)},[i.open]),useEffect(function(){i.open?(null==P?void 0:P.current)&&O(P.current):(null==m?void 0:m.keepOpen)||O(null)},[m,i]);return _jsxs(_Fragment,{children:[_jsx(StatusCore,__assign({},{ref:P,onLoad:function(e){O(e.current)},id:n,order:o,disabled:t,tooltip:i.open?null:p,highlight:(null!=m&&m.keepOpen||void 0!==i.open)&&i.open?Highlight.PRIMARY:r,secondary:l,options:{separators:k,popper:__assign(__assign({},b),{hasArrow:i.open&&b.hasArrow})},onClick:function(e){null!=m&&m.keepOpen||(c&&c(e),O(S?null:null==e?void 0:e.currentTarget),y(function(e){return!e}))},onContextMenu:d,style:__assign(__assign({},f),{cursor:(null==m?void 0:m.keepOpen)?"not-allowed":"pointer"}),className:_},{children:g})),_jsx(Component,__assign({},{id:n,enrichedPopper:b,highlight:r,statusObject:m,open:S,anchorEl:C,setAnchorEl:O,options:i,secondary:l}))]})}