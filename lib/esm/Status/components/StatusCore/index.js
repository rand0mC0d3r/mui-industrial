var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var o,n=1,e=arguments.length;n<e;n++)for(var r in o=arguments[n])Object.prototype.hasOwnProperty.call(o,r)&&(t[r]=o[r]);return t}).apply(this,arguments)};import{jsx as _jsx,Fragment as _Fragment,jsxs as _jsxs}from"react/jsx-runtime";import{Tooltip}from"@mui/material";import{forwardRef,useCallback,useContext,useEffect,useLayoutEffect,useState}from"react";import{createPortal}from"react-dom";import{Highlight,PlacementPosition}from"../../../index.types";import DataProvider,{composeDomId}from"../../../Store";import{SArrowDown,SArrowUp,SDiv,SSpan,STooltip}from"./css";var componentId="statusBar",defaultSeparatorOptions={start:!1,end:!1},defaultPopperOptions={hasArrow:!1};export var StatusCore=forwardRef(function(t,o){var n,e,r=t,i=r.id,s=r.order,a=r.style,l=r.onClick,u=r.onContextMenu,c=r.disabled,d=void 0!==c&&c,f=r.highlight,p=void 0===f?Highlight.DEFAULT:f,m=r.tooltip,g=r.children,_=r.options,S=r.secondary,h=void 0!==S&&S,v=r.onLoad,x=void 0===v?function(){}:v,y=useContext(DataProvider),j=y.status,w=y.handleStatusAnnouncement,P=useContext(DataProvider).settings,C=P.allowRightClick,D=P.position,b=useState(),E=b[0],O=b[1],A=useState(null),I=A[0],k=A[1],T=useState(null),F=T[0],L=T[1],M=__assign(__assign({},defaultSeparatorOptions),null==_?void 0:_.separators),B=__assign(__assign({},defaultPopperOptions),null==_?void 0:_.popper),R=useCallback(function(){w({id:i,ownId:E,secondary:h,children:g,options:_})},[i,h,E,_,g,w]);return useEffect(function(){i&&E&&null===I&&!j.some(function(t){return t.uniqueId===i})&&R()},[i,E,I,j,R]),useEffect(function(){var t=j.find(function(t){return t.uniqueId===i});null!==I&&(null==I?void 0:I.visible)===(null==t?void 0:t.visible)||!t||k(t)},[j,i,I]),useLayoutEffect(function(){null!==I&&L(document.getElementById(composeDomId(componentId,[h?"secondary":"primary"]))||null)},[h,I]),useEffect(function(){O((Math.random()+1).toString(36).substring(7))},[]),useEffect(function(){i||console.error("Please define an id for the status bar item")},[i]),useEffect(function(){return function(){}},[]),useEffect(function(){null!==I&&i&&F&&x(o)},[I,i,F,o,x]),_jsx(_Fragment,{children:null!==I&&!!i&&F&&createPortal(I.visible&&g&&_jsxs(SDiv,__assign({},{id:i,ref:o,key:"mui-status-".concat(i),onClick:function(t){void 0===l||d||(t.preventDefault(),l(t))},onContextMenu:function(t){t.preventDefault(),C&&void 0!==u&&!d&&u(t)},style:__assign(__assign({},a),{order:s||I.index}),highlight:p,secondary:h.toString(),startSeparator:null===(n=M.start)||void 0===n?void 0:n.toString(),endSeparator:null===(e=M.end)||void 0===e?void 0:e.toString(),hasclick:(!!l).toString(),isdisabled:d.toString()},{children:[B.hasArrow&&_jsx(_Fragment,{children:D===PlacementPosition.BOTTOM?_jsx(SArrowUp,{color:"primary"}):_jsx(SArrowDown,{position:D.toString(),color:"primary"})}),m?_jsx(Tooltip,__assign({title:_jsx(STooltip,{children:m}),arrow:!0},{children:_jsx(SSpan,{children:g})})):_jsx(SSpan,{children:g})]})),F)})});export default StatusCore;